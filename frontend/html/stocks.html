<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>股票追蹤系統</title>
    <link rel="stylesheet" href="/assets/styles.css">
    <link rel="stylesheet" href="/assets/stock.css">
    <script src="/assets/auth.js" defer></script>
    <script src="/assets/stocks.js" defer></script>
    <script>
        function updateStockRow(data) {
            const rowId = `stock-row-${data.symbol}`;
            let row = document.getElementById(rowId);

            const profitClass = data.profit >= 0 ? "profit-positive" : "profit-negative";
            const avgPriceDisplay = data.avg_price !== undefined ? parseFloat(data.avg_price).toFixed(2) : '-';

            if (!row) {
                row = document.createElement("tr");
                row.id = rowId;
                row.innerHTML = `
                    <td>${data.symbol}</td>
                    <td>${data.shares}</td>
                    <td id="avg-${data.symbol}">${avgPriceDisplay}</td>
                    <td id="price-${data.symbol}">${data.price.toFixed(2)}</td>
                    <td id="profit-${data.symbol}" class="${profitClass}">${data.profit.toFixed(2)}</td>
                `;
                document.getElementById("stock-table-body").appendChild(row);
            } else {
                document.getElementById(`price-${data.symbol}`).textContent = data.price.toFixed(2);
                document.getElementById(`avg-${data.symbol}`).textContent = avgPriceDisplay;
                const profitCell = document.getElementById(`profit-${data.symbol}`);
                profitCell.textContent = data.profit.toFixed(2);
                profitCell.className = profitClass;
            }
        }
    </script>
</head>
<body>
    <header>
        <h1>📈 股票追蹤系統</h1>
        <nav>
            <ul>
                <li><a href="/index.html">首頁</a></li>
                <li><a href="/projects.html">功能展示</a></li>
            </ul>
        </nav>
    </header>

    <section class="content">
        <h2>輸入股票</h2>
        <form id="stock-form">
            <input type="text" id="symbol" placeholder="股票代碼 (e.g., 2330)" required>
            <input type="number" id="shares" placeholder="持股數量" required>
            <input type="number" id="avgPrice" step="0.01" placeholder="購入均價" required>
            <button type="submit">新增/更新</button>
        </form>

        <h2>我的持股</h2>
        <table border="1" width="100%">
            <thead>
                <tr>
                    <th>股票代碼</th>
                    <th>持股數</th>
                    <th>購入均價</th>
                    <th>即時價格</th>
                    <th>損益</th>
                </tr>
            </thead>
            <tbody id="stock-table-body">
                <!-- 股票列表會在這邊插入 -->
            </tbody>
        </table>
    </section>
</body>
</html>